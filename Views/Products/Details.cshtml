@model StyleSphere.Models.Products

@{
Layout = "_Layout";
ViewData["Title"] = "Product Details";
}


@* <!--Single Product Details-->
<div class="small-container single-product" id="product-details-container"></div> *@

@* For debugging to see if the model is implemented properly *@
@* @Model.id; *@


@* <div class="container mt-4">
    <h2>@Model.name</h2>
    <img src="@Model.image" alt="@Model.name" class="img-thumbnail" style ="max-width: 200px;"/>
    <p class="mt-2"><strong>Price:</strong> @Model.price.ToString("C")</p>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal">
        View more details
    </button>
</div> *@


@* Modal *@

<form>
    
    <div class="row">
        <div class="col-2">
            <img src="@Model.image" width=100% id="product-image" />
        </div>
        <div class="col-2">
            <h1>@Model.name</h1>
            <h4>₹@Model.price.00</h4>
            <div class="rating">
                @for (int j = 1; j <= 5; j++)
                {
                    if (j <= @Model.rating)
                    {
                        <i class="fa fa-star"></i>
                    }
                    else
                    {
                        <i class="fa fa-star-o"></i>
                    }
                }
            </div>
            <select>
                <option>Select Size</option>
                <option>S</option>
                <option>M</option>
                <option>L</option>
                <option>XL</option>
            </select>
            <form asp-action="AddToCart" asp-controller="Cart" method="post">
                <input type="hidden" name="id" value="@Model.id"/> 
                <input type="hidden" name="name" value="@Model.name"/> 
                <input type="hidden" name="price" value="@Model.price"/> 
                <input type="hidden" name="image" value="@Model.buyimage"/> 
                <input type="number" name="quantity" value="1" min="1"/> 
                <button class="btn" type="submit">Add to Cart</button>
            </form>
            <h3>Product Details</h3>
            <p>This is a @Model.name.ToLower() made from high-quality material, designed for style and comfort.</p>
        </div>
    </div>
</form>



@* <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script> *@
@* <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> *@
@* <script src="~/js/site.js"></script> *@

@* <script>
    $(document).ready(function () {
        // Function to extract product ID from URL
        function getProductIdFromUrl() {
            const segments = window.location.pathname.split('/');
            return parseInt(segments[segments.length - 1]); // Get last part of URL
        }

        const productId = getProductIdFromUrl();

        // Fetch all products and find the one with matching ID
        $.getJSON('/Products/GetProducts', function (products) {
            console.log(products);
            const product = products.find(p => p.id === productId);

            if (!product) {
                console.error("Product not found");
                return;
            }

            // console.log(product.image);

            // Generate dynamic star ratings
            let stars = '';
            for (let j = 1; j <= 5; j++) {
                stars += `<i class="fa ${j <= product.rating ? 'fa-star' : 'fa-star-o'}"></i>`;
            }

            const $row = $('<div class="row"></div>');

            const leftCol = $(`
                <div class="col-2">
                    <img src="/${product.image}" width="100%" id="product-image" />
                </div>
            `);

            const rightCol = $(`
                <div class="col-2">
                    <h1>${product.name}</h1>
                    <h4>${product.price}</h4>
                    <div class="rating">${stars}</div>
                    <select>
                        <option>Select Size</option>
                        <option>S</option>
                        <option>M</option>
                        <option>L</option>
                        <option>XL</option>
                    </select>
                    <input type="number" value="1" />
                    <button class="btn">Add to Cart</button>
                    <h3>Product Details</h3>
                    <p>This is a ${product.name.toLowerCase()} made from high-quality material, designed for style and comfort.</p>
                </div>
            `);

            $row.append(leftCol).append(rightCol);
            $('#product-details-container').append($row);

            rightCol.find('.btn').on('click' , function () {
            const quantity = parseInt(rightCol.find('input[type="number"]').val());
            const size = rightCol.find('select').val();

            if ( size === "Select Size" ){
                alert("Please select a size");
                return;
            }

            let cart = JSON.parse(sessionStorage.getItem("cartItems")) || [];
            console.log("Cart before adding item: ", cart);
            const existingIndex  = cart.findIndex( item => item.id === product.id && item.size === size);
            console.log("Exisiting Index: ",existingIndex);
            if ( existingIndex != -1 ) {
                cart[existingIndex].quantity += quantity;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.buyimage,
                    size: size,
                    quantity: quantity
                });
            }

            sessionStorage.setItem("cartItems", JSON.stringify(cart));
            alert("product added to cart!!!");
        });

        });
    });
</script> *@


